// generated by ./build_wah.py
// DO NOT MODIFY!
declare id "rolwah";
declare name "Roland Wah";
declare category "Guitar Effects";
declare description "Roland Wah";

import("stdfaust.lib");
import("guitarix.lib");

process(x) = x : _<:*(dry),(*(wet) : pre : fi.iir((b0/a0,b1/a0,b2/a0,b3/a0,b4/a0),(a1/a0,a2/a0,a3/a0,a4/a0))):>_ with {
    LogPot(a, x) = ba.if(a, (exp(a * x) - 1) / (exp(a) - 1), x);
    Inverted(b, x) = ba.if(b, 1 - x, x);
    s = 0.993;
    fs = float(ma.SR);
    pre = fi.dcblockerat(178.633638624);

    wet = wah_ctrl.wet_dry;
    dry = 1 - wet;

    Wah1 = (x : an.amp_follower_ud(0.01,0.1) : min(0.99) : max(0.1)): si.smooth(s);
    
    Wah2 = wah_ctrl.wah : Inverted(1) : LogPot(5) :  si.smooth(s);
    
    sl = wah_ctrl.mode;

    Wah3 = (os.oscs(freq) + 1) / 2 : min(0.98) : max(0.01) : Inverted(1) with {
        freq = wah_ctrl.freq;
    }; 

    Wah = select3(sl, Wah2, Wah1, Wah3);
     
    b0 = Wah*(Wah*pow(fs,2)*(fs*(1.67423892093516e-21*fs + 2.84356697701846e-17) + 4.21808310223676e-14) + fs*(fs*(fs*(-1.67086003986576e-21*fs - 2.84459385679371e-17) - 4.25288501077712e-14) - 5.40786717438269e-13)) + fs*(fs*(fs*(-2.25167399879093e-21*fs - 7.2000883805872e-17) - 1.122655366476e-13) - 6.39103500338903e-13);

    b1 = Wah*(Wah*pow(fs,3)*(-6.69695568374064e-21*fs - 5.68713395403691e-17) + fs*(pow(fs,2)*(6.68344015946305e-21*fs + 5.68918771358741e-17) - 1.08157343487654e-12)) + fs*(pow(fs,2)*(9.00669599516373e-21*fs + 1.44001767611744e-16) - 1.27820700067781e-12);

    b2 = Wah*(Wah*pow(fs,2)*(1.0045433525611e-20*pow(fs,2) - 8.43616620447352e-14) + pow(fs,2)*(-1.00251602391946e-20*pow(fs,2) + 8.50577002155424e-14)) + pow(fs,2)*(-1.35100439927456e-20*pow(fs,2) + 2.245310732952e-13);

    b3 = Wah*(Wah*pow(fs,3)*(-6.69695568374064e-21*fs + 5.68713395403691e-17) + fs*(pow(fs,2)*(6.68344015946305e-21*fs - 5.68918771358741e-17) + 1.08157343487654e-12)) + fs*(pow(fs,2)*(9.00669599516373e-21*fs - 1.44001767611744e-16) + 1.27820700067781e-12);

    b4 = Wah*(Wah*pow(fs,2)*(fs*(1.67423892093516e-21*fs - 2.84356697701846e-17) + 4.21808310223676e-14) + fs*(fs*(fs*(-1.67086003986576e-21*fs + 2.84459385679371e-17) - 4.25288501077712e-14) + 5.40786717438269e-13)) + fs*(fs*(fs*(-2.25167399879093e-21*fs + 7.2000883805872e-17) - 1.122655366476e-13) + 6.39103500338903e-13);

    a0 = Wah*(Wah*pow(fs,2)*(fs*(-1.00220281601996e-19*fs - 1.70950590451549e-17) - 1.90549124429613e-13) + fs*(fs*(fs*(4.01507415376654e-19*fs + 3.69834165265026e-17) + 1.74041670594569e-13) + 2.88710794590323e-12)) + fs*(fs*(fs*(1.17381624550525e-20*fs + 1.80001288492797e-17) + 5.87277230952925e-13) + 1.11753192188666e-11) + 4.37440597864126e-11;

    a1 = Wah*(Wah*pow(fs,3)*(4.00881126407982e-19*fs + 3.41901180903099e-17) + fs*(pow(fs,2)*(-1.60602966150662e-18*fs - 7.39668330530053e-17) + 5.77421589180647e-12)) + fs*(pow(fs,2)*(-4.69526498202101e-20*fs - 3.60002576985594e-17) + 2.23506384377333e-11) + 1.7497623914565e-10;

    a2 = Wah*(Wah*pow(fs,2)*(-6.01321689611973e-19*pow(fs,2) + 3.81098248859227e-13) + pow(fs,2)*(2.40904449225993e-18*pow(fs,2) - 3.48083341189137e-13)) + pow(fs,2)*(7.04289747303152e-20*pow(fs,2) - 1.17455446190585e-12) + 2.62464358718476e-10;

    a3 = Wah*(Wah*pow(fs,3)*(4.00881126407982e-19*fs - 3.41901180903099e-17) + fs*(pow(fs,2)*(-1.60602966150662e-18*fs + 7.39668330530053e-17) - 5.77421589180647e-12)) + fs*(pow(fs,2)*(-4.69526498202101e-20*fs + 3.60002576985594e-17) - 2.23506384377333e-11) + 1.7497623914565e-10;

    a4 = Wah*(Wah*pow(fs,2)*(fs*(-1.00220281601996e-19*fs + 1.70950590451549e-17) - 1.90549124429613e-13) + fs*(fs*(fs*(4.01507415376654e-19*fs - 3.69834165265026e-17) + 1.74041670594569e-13) - 2.88710794590323e-12)) + fs*(fs*(fs*(1.17381624550525e-20*fs - 1.80001288492797e-17) + 5.87277230952925e-13) - 1.11753192188666e-11) + 4.37440597864126e-11;
};
